name: Health Check Servers

on:
  schedule:
    # –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–∞–∂–¥—ã–µ 15 –º–∏–Ω—É—Ç
    - cron: '*/15 * * * *'
  workflow_dispatch:
    # –†—É—á–Ω–æ–π –∑–∞–ø—É—Å–∫

jobs:
  health-check:
    runs-on: ubuntu-latest
    
    steps:
    - name: Check Backend Health
      run: |
        echo "üîç Checking Backend Server (159.89.108.100)"
        
        # –ü—Ä–æ–≤–µ—Ä—è–µ–º API endpoint
        if curl -f -s --max-time 10 "http://159.89.108.100:8000/health" > /dev/null; then
          echo "‚úÖ Backend API is healthy"
        else
          echo "‚ùå Backend API is down!"
        fi
        
        # –ü—Ä–æ–≤–µ—Ä—è–µ–º HTTPS endpoint
        if curl -k -f -s --max-time 10 "https://159.89.108.100/health" > /dev/null; then
          echo "‚úÖ Backend HTTPS is healthy"
        else
          echo "‚ö†Ô∏è Backend HTTPS might have issues"
        fi

    - name: Check Frontend Health
      run: |
        echo "üîç Checking Frontend Server (139.59.158.109)"
        
        # –ü—Ä–æ–≤–µ—Ä—è–µ–º HTTP endpoint
        if curl -f -s --max-time 10 "http://139.59.158.109/health" > /dev/null; then
          echo "‚úÖ Frontend HTTP is healthy"
        else
          echo "‚ùå Frontend HTTP is down!"
        fi
        
        # –ü—Ä–æ–≤–µ—Ä—è–µ–º HTTPS endpoint
        if curl -k -f -s --max-time 10 "https://139.59.158.109/health" > /dev/null; then
          echo "‚úÖ Frontend HTTPS is healthy"
        else
          echo "‚ö†Ô∏è Frontend HTTPS might have issues"
        fi
        
        # –ü—Ä–æ–≤–µ—Ä—è–µ–º –¥–æ–º–µ–Ω
        if curl -k -f -s --max-time 10 "https://moonline.pw/health" > /dev/null; then
          echo "‚úÖ Domain moonline.pw is healthy"
        else
          echo "‚ö†Ô∏è Domain moonline.pw might not be configured yet"
        fi

    - name: Check API Connectivity
      run: |
        echo "üîç Checking API connectivity from Frontend"
        
        # –ü—Ä–æ–≤–µ—Ä—è–µ–º –ø—Ä–æ–∫—Å–∏—Ä–æ–≤–∞–Ω–∏–µ API
        if curl -k -f -s --max-time 10 "https://139.59.158.109/api/health" > /dev/null; then
          echo "‚úÖ API proxy is working"
        else
          echo "‚ö†Ô∏è API proxy might have issues"
        fi

    - name: Report Status
      if: always()
      run: |
        echo "üìä Health check completed"
        echo "Timestamp: $(date)"
        echo "Backend Server: 159.89.108.100"
        echo "Frontend Server: 139.59.158.109"
        echo "Domain: moonline.pw"